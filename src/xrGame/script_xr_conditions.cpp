#include "Stdafx.h"
#include "script_xr_conditions.h"
#include "script_xr_conditions_functions.h"

// set breakpoint on these functions for 'understanding' the sense of usage and
// the purpose of CAnyCallable
// bool test_adiahfuirhgarughargha(int a, int b) { return false; }
// bool test2_Afjreauhgaeughauegaoegheog(int a, int b, const xr_vector<int>& c)
// { return false; }

CScriptXRConditionsStorage::CScriptXRConditionsStorage() : m_pLevel{}
{
	/* for test
	REGISTER_FUNCTION_TO_XR_CONDITIONS(test_adiahfuirhgarughargha);
	REGISTER_FUNCTION_TO_XR_CONDITIONS(test2_Afjreauhgaeughauegaoegheog);

	this->getRegisteredFunctionByName("test_adiahfuirhgarughargha")(1,2);
	this->getRegisteredFunctionByName("test2_Afjreauhgaeughauegaoegheog")(1, 2,
	xr_vector<int>{});
	*/
}

CScriptXRConditionsStorage::~CScriptXRConditionsStorage() {}

void CScriptXRConditionsStorage::initialize(CLevel* pLevelManager)
{
	R_ASSERT2(pLevelManager,
		"you have to have a valid pointer of LevelManager! early calling?");

	m_pLevel = pLevelManager;

#if defined(IXRAY_USE_LUA_AND_CPP_IMPLEMENTATION) || defined(IXRAY_USE_CPP_ONLY_IMPLEMENTATION)
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(fighting_dist_ge);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(surge_started);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(surge_complete);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(surge_kill_all);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(signal_rocket_flying);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(quest_npc_enemy_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(animpoint_reached);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(distance_to_obj_ge);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(distance_to_obj_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(in_dest_smart_cover);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(active_item);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_nomove_nowpn);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b16_is_zone_active);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_bloodsucker_state);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(dist_to_story_obj_ge);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_has_nimble_weapon);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_has_active_nimble_weapon);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b202_inventory_box_empty);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_in_danger);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(object_exist);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_curr_action);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_snork);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_dog);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_psy_dog);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_polter);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_tushkano);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_burer);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_controller);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_flesh);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_monster_boar);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(dead_body_searching);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b47_npc_online);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(anomaly_has_artefact);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(zat_b29_anomaly_has_af);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b221_who_will_start);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(pas_b400_actor_far_forward);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(pas_b400_actor_far_backward);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(pri_a28_actor_is_far);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_enemy_smart);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(zat_b103_actor_has_needed_food);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(zat_b29_rivals_dialog_precond);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(poltergeist_get_actor_ignore);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(burer_gravi_attack);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b202_actor_treasure_not_in_steal);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b25_senya_spawn_condition);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(jup_b25_flint_gone_condition);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_deimos_phase);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_in_surge_cover);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_door_blocked_by_npc);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(has_active_tutorial);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(upgrade_hint_kardan);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(fighting_dist_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(enemy_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(black_screen);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_npc_name);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_enemy_name);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_playing_sound);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_alive);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(see_npc);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_see_npc);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(npc_in_actor_frustum);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_wounded);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(dist_to_actor_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(dist_to_actor_ge);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_obj_on_job);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(distance_to_obj_on_job_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(obj_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(one_obj_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(story_obj_in_zone_by_name);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(npc_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(health_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_health_le);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(npc_community);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(hitted_by);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(hitted_on_bone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(best_pistol);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(deadly_hit);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(killed_by);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_alive_all);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_alive_one);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_alive);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_dead_all);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_dead_one);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_dead);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(story_object_exist);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_has_item);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(npc_has_item);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_has_item_count);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(signal);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(counter_greater);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(counter_equal);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(check_smart_alarm_status);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(has_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(has_actor_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(see_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(has_enemy_in_current_loopholes_fov);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(talking);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(npc_talking);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(see_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_friend);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_neutral);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_factions_enemies);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_factions_friends);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_faction_enemy_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_faction_friend_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_faction_neutral_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_squad_friend_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_squad_enemy_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_squad_neutral_to_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(fighting_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(hit_by_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(killed_by_actor);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_has_weapon);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_active_detector);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(heavy_wounded);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(time_period);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_rain);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_heavy_rain);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_day);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_dark_night);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_jup_a12_mercs_time);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(zat_b7_is_night);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(zat_b7_is_late_attack_time);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(mob_has_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(mob_was_hit);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(actor_on_level);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_in_zone);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_has_enemy);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_in_zone_all);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squads_in_zone_b41);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(target_squad_name);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(target_smart_name);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_exist);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(is_squad_commander);
	IXRAY_LUA_TO_CPP_REGISTER_FUNCTION_TO_SCRIPT(squad_npc_count_ge);
#endif
}

void CScriptXRConditionsStorage::destroy() 
{
	m_pLevel = nullptr;
}
